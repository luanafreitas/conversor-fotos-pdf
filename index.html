<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Conversor de Foto para PDF com Cabeçalho</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 2rem;
    }
    input[type="file"] {
      margin: 1rem 0;
    }
    .preview {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
    }
    .preview img {
      width: 120px;
      height: auto;
      object-fit: contain;
      border: 1px solid #ccc;
      padding: 4px;
      background: #f9f9f9;
    }
  </style>
</head>
<body>
  <h1>Converter Fotos em PDF com Cabeçalho Escolar</h1>
  <input type="file" id="imageUpload" accept="image/*" multiple>
  <button onclick="gerarPDF()">Gerar PDF</button>
  <div class="preview" id="preview"></div>

  <script>
    const { jsPDF } = window.jspdf;
    const imageUpload = document.getElementById("imageUpload");
    const preview = document.getElementById("preview");
    let imagens = [];

    imageUpload.addEventListener("change", (e) => {
      imagens = Array.from(e.target.files);
      preview.innerHTML = "";
      imagens.forEach(img => {
        const reader = new FileReader();
        reader.onload = () => {
          const el = document.createElement("img");
          el.src = reader.result;
          preview.appendChild(el);
        };
        reader.readAsDataURL(img);
      });
    });

    function desenharCabecalho(doc) {
      doc.setFontSize(10);
      doc.setFont("helvetica", "normal");
      doc.text("ESCOLA MUNICIPAL PROFESSORA DIVA BATISTA DA SILVA", 15, 20);
      doc.text("DIRETORA: RITA GOMES", 15, 27);
      doc.text("COORDENADORA: NOEMIA PEREIRA", 120, 27);
      doc.text("PROFESSORA:", 15, 34);
      doc.text("____________________", 43, 34);
      doc.text("DATA:", 140, 34);
      doc.text("____ / ____ / ______", 155, 34);
      doc.text("ALUNO(A): _________________________________________________________", 15, 41);

      // Moldura
      doc.setLineWidth(0.5);
      doc.rect(10, 10, 190, 277); // borda A4
    }

    async function gerarPDF() {
      if (imagens.length === 0) return alert("Selecione ao menos uma imagem.");

      const pdf = new jsPDF();

      for (let i = 0; i < imagens.length; i++) {
        if (i > 0) pdf.addPage();
        desenharCabecalho(pdf);

        const img = await carregarImagem(imagens[i]);

        const larguraMax = 180;
        const alturaMax = 230;
        const x = 15;
        const y = 50;
        pdf.addImage(img, "JPEG", x, y, larguraMax, alturaMax);
      }

      pdf.save("fotos-com-cabecalhoo.pdf");
    }

    function carregarImagem(arquivo) {
      return new Promise(resolve => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.readAsDataURL(arquivo);
      });
    }
  </script>
</body>
</html>
